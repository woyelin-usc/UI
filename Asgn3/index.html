<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<link href="styles.css" rel="stylesheet" type="text/css" />

	<script type="text/javascript" src="canvas.js"></script>
	<script type="text/javascript" src="gentilis-normal-normal.js"></script>
	<script type="text/javascript" src="jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="dollar.js"></script>

	<script type="text/javascript">
	    //
		// Startup
		//
		var _isDown, _points, _r, _g, _rc, _timeout = null;

		function onClickEvent(x,y) {
			alert(x + ", " + y)
		}


		function onLoadEvent()
		{
			_points = new Array();
			_r = new DollarRecognizer();

			var canvas = document.getElementById('myCanvas');
			_g = canvas.getContext('2d');
			_g.fillStyle = "rgb(0,0,225)";
			_g.strokeStyle = "rgb(0,0,225)";
			_g.lineWidth = 3;
			_g.font = "16px Gentilis";
			_rc = getCanvasRect(canvas); // canvas rect on page
			_g.fillStyle = "rgb(255,255,136)";
			_g.fillRect(0, 0, _rc.width, 20);

			_isDown = false;
		}
		function getCanvasRect(canvas)
		{
			var w = canvas.width;
			var h = canvas.height;

			var cx = canvas.offsetLeft;
			var cy = canvas.offsetTop;
			while (canvas.offsetParent != null)
			{
				canvas = canvas.offsetParent;
				cx += canvas.offsetLeft;
				cy += canvas.offsetTop;
			}
			return {x: cx, y: cy, width: w, height: h};
		}
		function getScrollY()
		{
			var scrollY = $(window).scrollTop();
			return scrollY;
		}
		//
		// Mouse Events
		//
		function mouseDownEvent(x, y)
		{
			document.onselectstart = function() { return false; } // disable drag-select
			document.onmousedown = function() { return false; } // disable drag-select
			_isDown = true;

			x -= _rc.x;
			y -= _rc.y - getScrollY();

			if ((_timeout==null) && _points.length > 0) {
				console.log("In clear " +  _timeout)
				_g.clearRect(0, 0, _rc.width, _rc.height);
				_points.length = 1; // clear
			}
		
			_points[0] = new Point(x, y);
			drawText("Recording unistroke...");
			_g.fillRect(x - 4, y - 3, 9, 9);
		}
		function mouseMoveEvent(x, y)
		{
			if (_isDown)
			{
				x -= _rc.x;
				y -= _rc.y - getScrollY();
				_points[_points.length] = new Point(x, y); // append
				drawConnectedPoint(_points.length - 2, _points.length - 1);
			}
		}
		function mouseUpEvent(x, y)
		{
			document.onselectstart = function() { return true; } // enable drag-select
			document.onmousedown = function() { return true; } // enable drag-select
			if (_isDown)
			{
				_isDown = false;
				_timeout = setTimeout(function(){
					if (_points.length >= 10)
					{
						var result = _r.Recognize(_points, document.getElementById('useProtractor').checked);
						drawText("Result: " + result.Name + " (" + round(result.Score,2) + ").");
						if(result.Name == "play") $("#myvideo")[0].play()
						else if(result.Name == "pause") $("#myvideo")[0].pause()
						else if(result.Name == "increaseVolume") $("#myvideo")[0].volume += 0.1
						else if(result.Name == "decreaseVolume") $("#myvideo")[0].volume -= 0.1
						else if(result.Name == "muted") $("#myvideo")[0].muted = !$("#myvideo")[0].muted
						else if(result.Name == "increasePlaybackRate") $("#myvideo")[0].playbackRate+=0.2
						else if(result.Name == "decreasePlaybackRate") $("#myvideo")[0].playbackRate-=0.2
						else if(result.Name == "seekPlus") $("#myvideo")[0].currentTime+=5
						else if(result.Name == "seekMinus") $("#myvideo")[0].currentTime-=5
						else if(result.Name == "increaseWidth") $("#myvideo")[0].width+=20
						else if(result.Name == "decreaseWidth") $("#myvideo")[0].width-=20
						else if(result.Name == "increaseHeight") $("#myvideo")[0].height+=20
						else if(result.Name == "decreaseHeight") $("#myvideo")[0].height-=20
						_timeout = null
					}
					else // fewer than 10 points were inputted
					{
						drawText("Too few points made. Please try again.");
					}
				}, 3000);


				// var text = 'new Array(';
				// for (i in _points) {
				// 	text += "new Point(" + _points[i].X + "," + _points[i].Y+"), ";
				// }
				// console.log(text)

			}
		}
		function drawText(str)
		{
			_g.fillStyle = "rgb(255,255,136)";
			_g.fillRect(0, 0, _rc.width, 20);
			_g.fillStyle = "rgb(0,0,255)";
			_g.fillText(str, 1, 14);
		}
		function drawConnectedPoint(from, to)
		{
			_g.beginPath();
			_g.moveTo(_points[from].X, _points[from].Y);
			_g.lineTo(_points[to].X, _points[to].Y);
			_g.closePath();
			_g.stroke();
		}
		function round(n, d) // round 'n' to 'd' decimals
		{
			d = Math.pow(10, d);
			return Math.round(n * d) / d
		}
		//
		// Unistroke Adding and Clearing
		//
		function onClickAddExisting()
		{
			if (_points.length >= 10)
			{
				var unistrokes = document.getElementById('unistrokes');
				var name = unistrokes[unistrokes.selectedIndex].value;
				var num = _r.AddGesture(name, _points);
				drawText("\"" + name + "\" added. Number of \"" + name + "\"s defined: " + num + ".");
			}
		}
		function onClickAddCustom()
		{
			var name = document.getElementById('custom').value;
			if (_points.length >= 10 && name.length > 0)
			{
				var num = _r.AddGesture(name, _points);
				drawText("\"" + name + "\" added. Number of \"" + name + "\"s defined: " + num + ".");
			}
		}
		function onClickCustom()
		{
			document.getElementById('custom').select();
		}
		function onClickDelete()
		{
			var num = _r.DeleteUserGestures(); // deletes any user-defined unistrokes
			alert("All user-defined gestures have been deleted. Only the 1 predefined gesture remains for each of the " + num + " types.");
		}
	// -->


	</script>
</head>

<body onload="onLoadEvent()" onclick = "onClickEvent(event.clientX, event.clilentY)">
	<p>
		<table border="0" cellspacing="10">
			<tr>
				<head>Do gestures on below canvas</head><br>
				<canvas id="myCanvas" width="300" height="200" style="background-color:#dddddd"
								onmousedown="mouseDownEvent(event.clientX, event.clientY)"
								onmousemove="mouseMoveEvent(event.clientX, event.clientY)"
								onmouseup="mouseUpEvent(event.clientX, event.clientY)"
								oncontextmenu="return false;">
					<span style="background-color:#ffff88;">The &lt;canvas&gt; element is not supported by this browser.</span>
				</canvas>
				<p>
					<form style="font-size:10pt">
						<input type="radio" name="search" id="useGSS" checked>
						<span style="font-weight:bold">
							Use Golden Section Search <i>(original)</i>
						</span>
						<br />
						<input type="radio" name="search" id="useProtractor">
						<span style="font-weight:bold">
							Use Protractor <i>(faster)</i>
						</span>
						<br/>
					</form>
				</p>

				<!-- Editing area below stroking canvas area -->
				<!-- 				<table border="0" width="420" style="font-size:10pt">
				<tr>
					<td valign="top" align="left">Add as example of existing type:</td>
					<td valign="top" align="right">
						<select id="unistrokes" style="width:136px" onkeypress="if (event.keyCode == 13) onClickAddExisting()">
							<option selected value="triangle">triangle</option>
							<option value="x">x</option>
							<option value="rectangle">rectangle</option>
							<option value="circle">circle</option>
							<option value="check">check</option>
							<option value="caret">caret</option>
							<option value="zig-zag">zig-zag</option>
							<option value="arrow">arrow</option>
							<option value="left square bracket">left square bracket</option>
							<option value="right square bracket">right square bracket</option>
							<option value="v">v</option>
							<option value="delete">delete</option>
							<option value="left curly brace">left curly brace</option>
							<option value="right curly brace">right curly brace</option>
							<option value="star">star</option>
							<option value="pigtail">pigtail</option>
						</select>
					</td>
					<td valign="top" align="right">
						<input type="button" style="width:64px" value="  Add   " onclick="onClickAddExisting()" />
					</td>
				</tr>
				<tr>
					<td valign="top" align="left">Add as example of custom type:</td>
					<td valign="top" align="right">
						<input type="text" id="custom" style="width:130px" value="Type name here..." onclick="onClickCustom()" onkeypress="if (event.keyCode == 13) onClickAddCustom()" />
					</td>
					<td valign="top" align="right">
						<input type="button" style="width:64px" value="  Add   " onclick="onClickAddCustom()" />
					</td>
				</tr>
				<tr>
					<td valign="top" align="left">Delete all user-defined gestures:</td>
					<td valign="top" align="right">&nbsp;</td>
					<td valign="top" align="right">
						<input type="button" style="width:64px" value="Delete" onclick="onClickDelete()" />
					</td>
				</tr>
			</table>
			-->
			<!-- End of editing area below stroking canvas area -->
		</tr>
		<tr>
			<td valign="top">
				<video id="myvideo" controls width=350 height=280 src='../../../Desktop/giveme5.mp4'></video>

			</td>
		</tr>
		<tr>
			<td valign="top" align="left"></td>
		</tr>
	</table>
</p>
</body>
</html>